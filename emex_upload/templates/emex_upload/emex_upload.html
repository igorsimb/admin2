{% extends "core/layouts/blank.html" %}
{% block title %}Загрузка данных Emex{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-6">

    <div class="text-sm breadcrumbs mb-6">
        <ul>
            <li><a href="{% url 'index' %}" class="text-primary">Главная</a></li>
            <li class="text-gray-500">Загрузка данных Emex</li>
        </ul>
    </div>

    {% if messages %}
    <div class="space-y-2 mb-6">
        {% for message in messages %}
        <div role="alert" class="alert {% if message.tags == 'success' %}alert-success{% elif message.tags == 'warning' %}alert-warning{% elif message.tags == 'error' %}alert-error{% else %}alert-info{% endif %} shadow-md">
            <svg xmlns="http://www.w3.org/2000/svg" class="stroke-current shrink-0 h-6 w-6" fill="none" viewBox="0 0 24 24">
                {% if message.tags == 'success' %}
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                {% elif message.tags == 'error' or message.tags == 'warning' %}
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                {% else %}
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                {% endif %}
            </svg>
            <span>{{ message }}</span>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div class="card-body items-center text-center p-0">
        <h2 class="card-title text-2xl font-bold mb-4">Загрузка данных Emex (тестовая база)</h2>
        <p class="mb-6 text-base-content/60">Выберите txt-файл для загрузки и обработки (макс. размер 1GB).</p>

        <form action="{% url 'emex_upload:upload' %}" method="post" enctype="multipart/form-data" class="w-full max-w-md" id="upload-form">
            {% csrf_token %}
            <div class="form-control w-full">
                {{ form.file }}
            </div>

            <div class="card-actions justify-center mt-6">
                <button id="upload-btn" type="submit" class="btn btn-primary w-full">Загрузить файл</button>
            </div>
            <div id="loading-text" class="mt-4 hidden text-gray-500">⏳ Загрузка...</div>
        </form>
    </div>
</div>

<script>
document.getElementById("upload-form").addEventListener("submit", function() {
    const btn = document.getElementById("upload-btn");
    const loading = document.getElementById("loading-text");
    btn.disabled = true;
    btn.textContent = "Загрузка...";
    loading.classList.remove("hidden");
});
</script>
{% endblock %}
